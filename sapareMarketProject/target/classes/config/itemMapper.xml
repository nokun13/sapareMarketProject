<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="item">
	
	<insert id="crawlingProcess" parameterType="dto.itemDTO">
		insert into SAPAREITEM values(SAPAREITEM_ITEMID_seq.nextval, #{memberName}, #{itemPrice}, #{itemAbout}, #{itemViewCnt}, #{itemName}, #{itemImagePath}, #{itemStatus}, sysdate, #{itemType}, #{itemWantCnt}, #{itemFlagCnt})
	</insert>
	
	<select id="selectProcess" resultType="dto.itemDTO">
		select * from sapareItem
	</select>
	
	<select id="get" parameterType="dto.memberDTO" resultType="dto.itemDTO">
		select a.*, b.orderDate, b.orderPrice, b.orderId, c.reviewNo, c.reviewContent, c.reviewStar, d.profileImg, d.nickname
		from sapareItem a
		left outer join
		    sapareOrder b on a.itemId = b.itemId
		left outer join
		    sapareReview c on b.orderId = c.orderId
		left outer join
		    sapareMember d on b.memberName = d.memberName
		where a.memberName=#{memberName}
		order by a.itemUploadDate desc
	</select>
	
	<select id="getWeek" parameterType="dto.memberDTO" resultType="dto.itemDTO">
		select a.*, b.orderDate, b.orderPrice, b.orderId, c.reviewNo, c.reviewContent, c.reviewStar, d.profileImg, d.nickname
		from sapareItem a
		left outer join
		    sapareOrder b on a.itemId = b.itemId
		left outer join
		    sapareReview c on b.orderId = c.orderId
		left outer join
		    sapareMember d on b.memberName = d.memberName
		where a.memberName=#{memberName} and
        trunc(a.itemUploadDate) BETWEEN trunc(sysdate-7) and trunc(sysdate)
		order by a.itemUploadDate desc
	</select>
	
	<select id="getMonth" parameterType="dto.memberDTO" resultType="dto.itemDTO">
		select a.*, b.orderDate, b.orderPrice, b.orderId, c.reviewNo, c.reviewContent, c.reviewStar, d.profileImg, d.nickname
		from sapareItem a
		left outer join
		    sapareOrder b on a.itemId = b.itemId
		left outer join
		    sapareReview c on b.orderId = c.orderId
		left outer join
		    sapareMember d on b.memberName = d.memberName
		where a.memberName=#{memberName, jdbcType=VARCHAR} and
        trunc(a.itemUploadDate) BETWEEN trunc(sysdate-30) and trunc(sysdate)
		order by a.itemUploadDate desc
	</select>
	
	<select id="getSixMonths" parameterType="dto.memberDTO" resultType="dto.itemDTO">
		select a.*, b.orderDate, b.orderPrice, b.orderId, c.reviewNo, c.reviewContent, c.reviewStar, d.profileImg, d.nickname
		from sapareItem a
		left outer join
		    sapareOrder b on a.itemId = b.itemId
		left outer join
		    sapareReview c on b.orderId = c.orderId
		left outer join
		    sapareMember d on b.memberName = d.memberName
		where a.memberName=#{memberName} and
        trunc(a.itemUploadDate) BETWEEN trunc(sysdate-180) and trunc(sysdate)
		order by a.itemUploadDate desc
	</select>
	
	<select id="wantItem" parameterType="dto.memberDTO" resultType="dto.itemDTO">
		select z.*
        from(
        select b.*
		from saparewantitem a
		inner join sapareitem b on b.itemId=a.itemId
		where a.memberName=#{memberName}
		order by b.itemId desc)z
        where lower(membername) like lower('%'||#{searchWord, jdbcType=VARCHAR}||'%')
        or lower(itemprice) like lower('%'||#{searchWord, jdbcType=VARCHAR}||'%')
        or lower(itemabout) like lower('%'||#{searchWord, jdbcType=VARCHAR}||'%')
        or lower(itemname) like lower('%'||#{searchWord, jdbcType=VARCHAR}||'%')
        order by itemId desc
	</select>
	
	<select id="wantNumItem" parameterType="dto.memberDTO" resultType="dto.itemDTO">
		select z.*
        from(
        select b.*
		from saparewantitem a
		inner join sapareitem b on b.itemId=a.itemId
		where a.memberName=#{memberName}
		order by b.itemId desc)z
        where lower(membername) like lower('%'||#{searchWord, jdbcType=VARCHAR}||'%')
        or lower(itemprice) like lower('%'||#{searchWord, jdbcType=VARCHAR}||'%')
        or lower(itemabout) like lower('%'||#{searchWord, jdbcType=VARCHAR}||'%')
        or lower(itemname) like lower('%'||#{searchWord, jdbcType=VARCHAR}||'%')
        order by itemwantcnt desc
	</select>
	
	<select id="wantPriceItem" parameterType="dto.memberDTO" resultType="dto.itemDTO">
		select z.*
        from(
        select b.*
		from saparewantitem a
		inner join sapareitem b on b.itemId=a.itemId
		where a.memberName=#{memberName}
		order by b.itemprice asc)z
        where lower(membername) like lower('%'||#{searchWord, jdbcType=VARCHAR}||'%')
        or lower(itemprice) like lower('%'||#{searchWord, jdbcType=VARCHAR}||'%')
        or lower(itemabout) like lower('%'||#{searchWord, jdbcType=VARCHAR}||'%')
        or lower(itemname) like lower('%'||#{searchWord, jdbcType=VARCHAR}||'%')
        order by itemprice asc
	</select>
	
	<select id="sellingOnly" parameterType="dto.memberDTO" resultType="dto.itemDTO">
		select a.*, b.orderDate, b.orderPrice, b.orderId, c.reviewNo, c.reviewContent, c.reviewStar, d.profileImg, d.nickname
		from sapareItem a
		left outer join
		    sapareOrder b on a.itemId = b.itemId
		left outer join
		    sapareReview c on b.orderId = c.orderId
		left outer join
		    sapareMember d on b.memberName = d.memberName
		where a.memberName=#{memberName} and
        a.itemStatus = 'y'
		order by a.itemUploadDate desc
	</select>
	
	<select id="soldOnly" parameterType="dto.memberDTO" resultType="dto.itemDTO">
		select a.*, b.orderDate, b.orderPrice, b.orderId, c.reviewNo, c.reviewContent, c.reviewStar, d.profileImg, d.nickname
		from sapareItem a
		left outer join
		    sapareOrder b on a.itemId = b.itemId
		left outer join
		    sapareReview c on b.orderId = c.orderId
		left outer join
		    sapareMember d on b.memberName = d.memberName
		where a.memberName=#{memberName} and
        a.itemStatus = 'n'
		order by a.itemUploadDate desc
	</select>
	
	<select id="sellSearch" parameterType="dto.memberDTO" resultType="dto.itemDTO">
		select z.*
            from (select a.*, b.orderDate, b.orderPrice, b.orderId, c.reviewNo, c.reviewContent, c.reviewStar,d.profileImg, d.nickname
		from sapareItem a
		left outer join
		    sapareOrder b on a.itemId = b.itemId
		left outer join
		    sapareReview c on b.orderId = c.orderId
		left outer join
		    sapareMember d on b.memberName = d.memberName
		where a.memberName=#{memberName}
		order by a.itemId desc) z
        where lower(itemname) like lower('%'||#{searchWord}||'%')
        or lower(itemabout) like lower('%'||#{searchWord}||'%')
        or lower(membername) like lower('%'||#{searchWord}||'%')
        or lower(itemprice) like lower('%'||#{searchWord}||'%')
        order by itemuploaddate desc
	</select>
	
</mapper>